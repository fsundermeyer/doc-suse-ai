[#openwebui-authentication-via-okta]
ifdef::override-title[]
= {override-title}
endif::[]
ifndef::override-title[]
= Authenticating {owui} via {okta}
endif::[]

{okta} is an identity management service that allows you to manage users and user access to applications.
This topic describes how to use {okta} as the identity manager for {owui}. 

The process of enabling {okta} as the identity manager for {owui} consists of several steps: 

. <<owui-config-okta,Configuring {okta}>>
. <<owui-gather-data,Gathering data for {owui} configuration>>
. <<configure-owui-for-okta,Configuring {owui} for {okta} integration>>

[TIP]
====
This example procedure shows the minimal configuration required to use {okta} with {owui}. Customize the configuration to your specific scenario and refer to the {okta} documentation at https://help.okta.com/en-us/content/index.htm?cshid=csh-index for more information. 
====

[#owui-config-okta]
== Configuring {okta}

[IMPORTANT]
====
You must have administrator privileges to perform the following steps. 
====
. Log in to {okta} and access the menu:Admin[] panel. 
+
.{okta} administrator panel
image::owui-okta-admin-panel.png[{okta} administrator panel,scaledwidth=100%]
+
. Go to menu:Applications[Create App Integration] . 
. In the menu:Sign-in method[] section, select menu:OIDC - OpenID Connect[] . In the menu:Application type[] section, select menu:Web Application[] . Click menu:Next[] to proceed. 
+
.{okta} configuration window
image::owui-okta-configure1.png[{okta} configuration window,scaledwidth=75%]
+
. In the menu:General Settings[] section, set the menu:App integration name[] to menu:{owui}[] . In the menu:Grant type[] section, toggle the menu:Refresh token[] option. Optionally, specify an image for the application logo. 
. Set menu:Sign-in redirect URIs[] to the callback URI, for example, `http://localhost:8080/oauth/oidc/callback`. The URI follows this pattern: 
+
----
PROTOCOL://OPENWEBUI_DOMAIN:OPTIONAL_PORT_NUMBER/oauth/oidc/callback
----
. Similarly, set menu:Sign-out redirect URIs[] to 
+
----
PROTOCOL://OPENWEBUI_DOMAIN:OPTIONAL_PORT_NUMBER
----
. In the menu:Assignments[] section, toggle the menu:Skip group assignment for now[] option. Save changes. 
+
.{owui} application settings
[TIP]
====
After the integration is created, you can access the {owui} application settings by clicking the related hyperlink.
It is required for final configurations and for retrieving the necessary information for the {owui} configuration further on. 

.{owui} application access in {okta}
image::owui-okta-app-access.png[{owui} application access in {okta},scaledwidth=75%]
====
+
. In the menu:General Settings[] section, click menu:Edit[] and in the menu:Login[] section, set the menu:Sign-in redirect URIs[] option to the URI in this format: 
+
----
PROTOCOL://OPENWEBUI_DOMAIN:OPTIONAL_PORT_NUMBER/oauth/oidc/callback
----
. In the menu:Login initiated by[] section, select menu:App Only[] . Confirm with menu:Save[] . 

[#owui-gather-data]
== Gathering data for {owui} configuration
. In the top-right menu, copy the {okta} domain. In this example, it is `my-domain.okta.com`. 
+
.{okta} domain name
image::owui-okta-gather-info.png[{okta} domain name,scaledwidth=50%]
. Go to menu:Applications[{owui}] and retrieve the menu:Client ID[] and menu:Client Secret[] . 
+
.Client ID and secret in {okta}
image::owui-okta-clientid.png[Client ID and secret in {okta},scaledwidth=50%]
+
[TIP]
====
The previously gathered values are used by {owui} via the following environment variables as described in xref:configure-owui-for-okta[].
----
OPENID_PROVIDER_URL="OKTA_DOMAIN/.well-known/openid-configuration"
OAUTH_CLIENT_ID="CLIENT_ID"
OAUTH_CLIENT_SECRET="CLIENT_SECRET"
----
====

[#configure-owui-for-okta]
== Configuring {owui} for {okta} integration

To configure {owui} to use {okta} as an authentication provider, you must set up specific environment variables.
For more information about OAuth 2.0 in {owui} and a complete description of each environment variable, refer to https://docs.openwebui.com/features/sso[{owui} SSO] documentation. 

. Add the following environment variables to your {helm} charts `values.yaml` file in the `extraEnvVars` section. 
+
----
ENABLE_OAUTH_SIGNUP=true <.>
OAUTH_MERGE_ACCOUNTS_BY_EMAIL=true <.>
OAUTH_CLIENT_ID=CLIENT_ID <.>
OAUTH_CLIENT_SECRET=CLIENT_SECRET
OPENID_PROVIDER_URL=OKTA_DOMAIN/.well-known/openid-configuration
OAUTH_PROVIDER_NAME=Okta
OAUTH_SCOPES=openid email profile <.>
----
+
<.> Allow account creation when logging in with OAuth 2.0.
<.> Allow logging into an account that matches the e-mail address provided by the OAuth 2.0 provider  _(Optional)_.
<.> Variable set for the authentication provider gathered from {okta}.
<.> Specify scopes to request (optional, defaults to `openid email profile` ).
+
The code block should look as follows: 
+
----
extraEnvVars:
  - name: ENABLE_OAUTH_SIGNUP
    value: "True"
  - name: OAUTH_MERGE_ACCOUNTS_BY_EMAIL
    value: "True"
  - name: OAUTH_CLIENT_ID
    value: "CLIENT_ID"
  - name: OAUTH_CLIENT_SECRET
    value: "CLIENT_SECRET"
  - name: OPENID_PROVIDER_URL
    value: "OKTA_DOMAIN/.well-known/openid-configuration"
  - name: OAUTH_PROVIDER_NAME
    value: "Okta"
  - name: OAUTH_SCOPES
    value: "openid email profile"
----
. Restart {owui} to apply the changes. 
. If the configuration went well, you should see the menu:Continue with Okta[] button as an option on both sign-in and sign-up pages.
  After you click the button, you will be redirected to the {okta} login page, or automatically signed in if you are already logged in to {okta}. 
+
image::owui-okta-signin.png[{owui},scaledwidth=50%]
